<!DOCTYPE html>
<html lang="en">
<head>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="UTF-8">
    <title>设计师管理添加模板页面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <!--公共样式-->
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../assets/css/ace.min.css"/>
    <!--页面CSS-->
    <link rel="stylesheet" href="../assets//css/common/common.css"/>
    <link rel="stylesheet" href="../assets/css/designerManage/designerManageAdd.css"/>

</head>
<body>

<div class="main-container" id="main-container">
    <div class="main-content">
        <div class="page-content">
            <div class="page-content-area">
                <div class="row">
                    <div class="col-xs-12">
                        <!--loading flash-->
                        <div class="spinner-wrap">
                            <div class="spinner-x">
                                <div class="rect1"></div>
                                <div class="rect2"></div>
                                <div class="rect3"></div>
                                <div class="rect4"></div>
                                <div class="rect5"></div>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail h170 w17 l">设计师头像</div>
                            <div class="order-detail h170 w81 r" id="img1">
                                <div class="img_container1" style="display: inline-block" ></div>
                                <div id="addPosition1"><a href="javascript:;" class="file">选择文件 <input id="upLoad1" type="file" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg"> </a></div>
                                <input style="display: none" id="isIcon" value="false">
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l"><span class="necessary">*</span>手机号</div>
                            <div class="order-detail w81 r">
                                <input id="phone" class="phone-num" type="number" onblur="checkMobile()">
                                <span class="error-info error-phone">请输入正确的手机号</span>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l"><span class="necessary">*</span>真实姓名</div>
                            <div class="order-detail w81 r">
                                <!--<input type="text" id="name">-->
                                <input id="name" class="supplier-name check-supplier" type="text" onblur="checkSupplierName()">
                                <span class="error-info error-supplier">名称最长30个字符</span>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l"><span class="necessary">*</span>性别</div>
                            <div class="order-detail w81 r" id="sex">
                                <input style="margin-right: 5px" type="radio" name="sex" value="1" checked>男&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <input style="margin-right: 5px" type="radio" name="sex" value="2">女
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l">用户身份</div>
                            <div class="order-detail w81 r">
                                <select class="storage-admin-select" id="type">
                                    <option value=""></option>
                                    <option value="1">在校学生</option>
                                    <option value="2">自由设计师</option>
                                    <option value="3">设计工作室</option>
                                    <option value="4">其它</option>
                                </select>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l h136">个人简介</div>
                            <div class="order-detail w81 r h136">
                                <textarea class="input-tip" id="resume"></textarea>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l h136">备注</div>
                            <div class="order-detail w81 r h136">
                                <textarea class="input-tip" id="remarks"></textarea>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 l"><span class="necessary">*</span>是否展示</div>
                            <div class="order-detail w81 r">
                                <select class="storage-admin-select" id="isShow">
                                    <option value=""></option>
                                    <option value="1">是</option>
                                    <option value="0">否</option>
                                </select>
                            </div>
                        </div>
                        <div class="order-detail-wrap clearfix">
                            <div class="order-detail w17 h178 l"><span class="necessary">*</span>地址</div>
                            <div class="w81 pdl0 r">
                                <div class="order-detail pdl0">
                                    <div class="order-detail h56" id="province" style="padding-left: 20px">
                                        <select id="cmbProvince" name="cmbProvince"></select>
                                        <select id="cmbCity" name="cmbCity" style="margin: 0 20px"></select>
                                        <select id="cmbArea" name="cmbArea"></select>
                                    </div>
                                </div>
                                <div class="order-detail pdl0 h118">
                                    <textarea id="address" class="input-address" placeholder="地址信息最多100字"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="wysiwyg-editor" id="editor1"></div>

                        <div class="pdt20" style="text-align: center">
                            <button class="admin-btn w100" id="confirm">提交</button>
                            <button class="admin-btn w100 ml20"id="goBack" onclick="history.go('-1')">返回</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--摸态窗-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header" style="height: 41px;padding: 7px">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">确认</h4>
            </div>
            <div class="modal-body">
                <span>添加成功！</span>
            </div>
            <div class="modal-footer">
                <div class="sure" id="sure">确认</div>
            </div>
        </div>
    </div>
</div>
<!--[if !IE]> -->
<script type="text/javascript">
    window.jQuery || document.write("<script src='../assets/js/jquery.min.js'>" + "<" + "/script>");
</script>
<!-- <![endif]-->
<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='../assets/js/jquery1x.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='../assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-ui.custom.min.js"></script>
<script src="../assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="../assets/js/ace.min.js"></script>
<script src="../assets/js/ace-elements.min.js"></script>
<script src="../assets/js/jquery.page.js"></script>
<script src="../assets/js/jquery.hotkeys.min.js"></script>
<script src="../assets/js/bootstrap-wysiwyg.min.js"></script>
<script src="../assets/js/bootbox.min.js"></script>
<script src="../assets/js/common/validate.js"></script>
<script type="text/javascript" src="../assets/js/layer/layer.js"></script>
<script src="../assets/js/designerManage/designerManageAdd.js"></script>
<script type="text/javascript">
    jQuery(function($){

        function showErrorAlert (reason, detail) {
            var msg='';
            if (reason==='unsupported-file-type') { msg = "Unsupported format " +detail; }
            else {
                //console.log("error uploading file", reason, detail);
            }
            $('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button>'+
                '<strong>File upload error</strong> '+msg+' </div>').prependTo('#alerts');
        }

        //$('#editor1').ace_wysiwyg();//this will create the default editor will all buttons

        //but we want to change a few buttons colors for the third style
        $('#editor1').ace_wysiwyg({
            toolbar:
                [
                    'font',
                    null,
                    'fontSize',
                    null,
                    {name:'bold', className:'btn-info'},
                    {name:'italic', className:'btn-info'},
                    {name:'strikethrough', className:'btn-info'},
                    {name:'underline', className:'btn-info'},
                    null,
                    {name:'insertunorderedlist', className:'btn-success'},
                    {name:'insertorderedlist', className:'btn-success'},
                    {name:'outdent', className:'btn-purple'},
                    {name:'indent', className:'btn-purple'},
                    null,
                    {name:'justifyleft', className:'btn-primary'},
                    {name:'justifycenter', className:'btn-primary'},
                    {name:'justifyright', className:'btn-primary'},
                    {name:'justifyfull', className:'btn-inverse'},
                    null,
                    {name:'createLink', className:'btn-pink'},
                    {name:'unlink', className:'btn-pink'},
                    null,
                    {name:'insertImage', className:'btn-success'},
                    null,
                    'foreColor',
                    null,
                    {name:'undo', className:'btn-grey'},
                    {name:'redo', className:'btn-grey'}
                ],
            'wysiwyg': {
                fileUploadError: showErrorAlert
            }
        }).prev().addClass('wysiwyg-style2');

        if ( typeof jQuery.ui !== 'undefined' && ace.vars['webkit'] ) {

            var lastResizableImg = null;
            function destroyResizable() {
                if(lastResizableImg == null) return;
                lastResizableImg.resizable( "destroy" );
                lastResizableImg.removeData('resizable');
                lastResizableImg = null;
            }
        }
        // 转码照片为base64的字符串
        var readFileIntoDataUrl = function (fileInfo) {
            var loader = $.Deferred(),
                fReader = new FileReader();
            fReader.onload = function (e) {
                loader.resolve(e.target.result);
            };
            fReader.onerror = loader.reject;
            fReader.onprogress = loader.notify;
            fReader.readAsDataURL(fileInfo);
            return loader.promise();
        };
        var uploadFiles = [];
        // 监听选取照片的按钮<input type="file" data-role="magic-overlay" data-target="#pictureBtn" data-edit="insertImage" />，
        // 把每次选取的照片文件放入数组中
        $("#descripitionImg").change(function(){
            $.each(this.files,function(index,fileObj){
                uploadFiles.push(fileObj);
            });
        });
        function uploadImgs(index){
            // 使用FormData对象上传文件
            // 这里上传使用递归上传，上传一个再次调用函数本身，再次上传，知道全部上传完成
            var formData = new FormData();
            if(0 >= index){
                // 再次上传文本编辑器里的内容
            }else{
                //console.log('执行照片提交。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。');
                index -=1;
                formData.append(uploadFiles[index].name,uploadFiles[index]);
                var xhr = new XMLHttpRequest();
                xhr.open("POST",FILEUPLOAD_URL2,true);
                xhr.send(formData);
                xhr.onload = function(data){
                    // 判断图片是否存在
                    var imgTag = [];
                    readFileIntoDataUrl(uploadFiles[index]).done(function (dataUrl) {
                        imgTag = $("#editor").find("img[src='" + dataUrl + "']");
                        if (imgTag.length > 0) {
                            // 图片存在, 上传当前文件.
                            // uploadImage方法为你的上传图片方法.
                            var url = JSON.parse(data.currentTarget.response).resMsg;
                            imgTag.attr("src", url);
                            // 重新调用函数
                            uploadImgs(index);

                        }

                    });
                }
            }
        }
    });
</script>
</body>
</html>